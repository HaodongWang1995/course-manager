# 需求：教师编辑课时和作业

## 基本信息
- **状态**：开发中
- **优先级**：P0
- **创建日期**：2026-02-24
- **最后更新**：2026-02-24

## 需求描述

教师在课程详情页可以编辑已有的课时（Schedule）和作业（Assignment）。目前教师只能新增和删除，缺少编辑功能。

### 课时编辑
- 编辑已有课时的标题、开始时间、结束时间、教室
- 复用新增课时对话框的表单布局

### 作业编辑
- 编辑已有作业的标题、描述、截止日期
- 复用新增作业对话框的表单布局

## 验收标准

- [ ] 课时列表每一项有「编辑」按钮，点击弹出编辑对话框，保存后即时刷新列表
- [ ] 作业列表每一项有「编辑」按钮，点击弹出编辑对话框，保存后即时刷新列表
- [ ] 后端 API：PUT /api/schedules/:id 可正常工作（已存在）
- [ ] 后端 API：PUT /api/assignments/:id 可正常工作（需新增）
- [ ] 编辑对话框中的表单字段与新增对话框一致
- [ ] i18n 覆盖所有新增文案（中/英）

## 实现方案

### 现状分析

| 模块 | 后端 API | 前端 UI | Query Hook | 备注 |
|------|----------|---------|------------|------|
| 课时编辑 | ✅ PUT /api/schedules/:id 已存在 | ❌ 无编辑按钮/对话框 | ✅ useUpdateSchedule 已存在 | 只差前端 UI |
| 作业编辑 | ❌ 无 PUT 端点 | ❌ 无编辑按钮/对话框 | ❌ 无 useUpdateAssignment | 需要全链路 |

### 涉及文件

**后端（作业编辑）：**
- `apps/api/src/routes/assignments.ts` — 新增 PUT /api/assignments/:id 端点

**前端（课时编辑）：**
- `apps/web/src/pages/teacher/course-detail/components/schedule-section.tsx` — 添加编辑按钮
- `apps/web/src/pages/teacher/course-detail/components/add-schedule-dialog.tsx` — 改造为支持编辑模式（传入初始值）

**前端（作业编辑）：**
- `apps/web/src/pages/teacher/course-detail/components/assignment-section.tsx` — 添加编辑按钮
- `apps/web/src/pages/teacher/course-detail/components/add-assignment-dialog.tsx` — 改造为支持编辑模式
- `apps/web/src/hooks/use-queries.ts` — 新增 useUpdateAssignment mutation
- `apps/web/src/api/client.ts` — 新增 assignmentApi.update() 方法

**i18n：**
- `apps/web/src/locales/en.json` — 新增 edit 相关 key
- `apps/web/src/locales/zh.json` — 新增 edit 相关 key

### API 变更

| 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|
| PUT | `/api/assignments/:id` | Teacher（课程所有者） | 更新作业标题、描述、截止日期 |

### 数据库变更

无需迁移。assignments 表现有字段已支持编辑。

## 任务清单

- [ ] 后端：新增 PUT /api/assignments/:id 端点（验证教师权限）
- [ ] 前端：改造 add-schedule-dialog 支持编辑模式（接收 initialData prop）
- [ ] 前端：schedule-section 添加编辑按钮，点击打开编辑对话框
- [ ] 前端：改造 add-assignment-dialog 支持编辑模式
- [ ] 前端：assignment-section 添加编辑按钮
- [ ] 前端：新增 useUpdateAssignment mutation hook
- [ ] 前端：新增 assignmentApi.update() 方法
- [ ] i18n：新增编辑相关翻译 key（editSchedule、editAssignment）
- [ ] 测试：为 PUT /api/assignments/:id 编写集成测试

## 备注

- 课时编辑的后端 + hook 已完整，只需前端 UI
- 作业编辑需要全链路（API → client → hook → UI）
- 对话框改造建议：新增 `mode: "create" | "edit"` prop 和 `initialData` prop，复用表单布局
