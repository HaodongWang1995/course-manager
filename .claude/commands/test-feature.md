# 测试功能

运行全量测试，如果发现问题则自动创建 TODO 文档记录。

## 流程

### 步骤 1 — 运行全量测试

```bash
# 单元/集成测试
pnpm test -- --reporter=verbose

# 类型检查
pnpm typecheck
```

记录：通过数量、失败数量、失败的测试名称和错误信息。

### 步骤 2 — E2E 测试

```bash
cd apps/web && pnpm e2e
```

如有 E2E 测试失败，记录截图路径和错误描述。

### 步骤 3 — 线上回归（可选）

如用户指定了线上测试，使用 Playwright MCP 访问线上地址 http://100.23.242.232 ：
1. 教师账号全流程：登录 → Dashboard → 创建课程 → 添加课时 → 上传附件 → 审核选课
2. 学生账号全流程：注册 → 浏览课程 → 申请选课 → 查看日程 → 下载附件
3. 记录每个页面的异常现象

### 步骤 4 — 汇总结果

向用户展示测试结果：

```
【测试结果】
- 单元测试：X passed / Y failed
- E2E 测试：X passed / Y failed
- 类型检查：通过/失败

发现问题：
1. [失败测试名] — {错误描述}
2. [页面/功能] — {异常现象}

未发现问题则显示：全部通过，无新增问题。
```

### 步骤 5 — 为每个问题创建 TODO

如果发现问题（测试失败或线上异常），为**每个独立问题**创建 TODO 文档。

在 `PRD/` 目录下创建：`TODO-{问题简写}-{YYYYMMDD}.md`

```markdown
# TODO: {问题标题}

> 创建时间：{YYYY-MM-DD}
> 优先级：{根据严重程度判断 P0/P1/P2}
> 状态：待修复
> 来源：测试发现

---

## 问题描述

{详细描述现象}

## 失败测试

- 测试名称：`{test name}`
- 错误信息：
  ```
  {error message}
  ```

## 复现步骤

1. {步骤}

## 涉及模块

- {文件路径}

## 任务清单

- [ ] 定位根因
- [ ] 修复问题
- [ ] 补充/修复测试
```

**优先级判断规则：**
- **P0**：核心流程阻断（登录、选课、创建课程失败）
- **P1**：功能异常但不阻断（显示错误、数据不一致）
- **P2**：UI 瑕疵、非关键路径问题

### 步骤 6 — 提交

```bash
git add PRD/
git commit -m "docs(TODO): 测试发现 {N} 个问题"
```

### 步骤 7 — 询问后续

```
已创建 {N} 个 TODO 文档：
1. [P0] {标题} — PRD/TODO-xxx.md
2. [P1] {标题} — PRD/TODO-xxx.md

是否现在【按优先级开发】修复这些问题？
```

如用户确认，进入按优先级开发流程。
